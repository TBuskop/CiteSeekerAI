<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CiteSeekerAI - Research Assistant</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">    <link href="/static/css/styles.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css">
    <link rel="icon" type="image/png" sizes="32x32" href="/static/img/favicon.ico">

</head>
<body>
    <nav class="navbar navbar-expand-lg">
        <div class="container-fluid">
            <a class="navbar-brand" href="/">CiteSeekerAI</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link active" href="/">Chat</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/abstracts">Collect Abstracts</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container-fluid main-content-area">
        <div class="row flex-grow-1">
            <div class="col-md-3 d-flex flex-column">
                <div class="mb-3 flex-shrink-0">
                    <button class="btn btn-outline-secondary w-100" id="new-chat-btn">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-plus-circle-fill me-1" viewBox="0 0 16 16">
                            <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM8.5 4.5a.5.5 0 0 0-1 0v3h-3a.5.5 0 0 0 0 1h3v3a.5.5 0 0 0 1 0v-3h3a.5.5 0 0 0 0-1h-3v-3z"/>
                        </svg>
                        New Chat
                    </button>
                </div>
                <div class="card flex-grow-1 d-flex flex-column">
                    <div class="card-header">
                        Previous Questions
                    </div>
                    <div class="card-body p-0 flex-grow-1 d-flex flex-column">
                        <div id="history-list" class="flex-grow-1 overflow-auto">
                            {% if chat_history %}
                                {% for job_id, chat in chat_history.items() %}
                                <div class="history-item" data-job-id="{{ job_id }}">
                                    <strong class="d-block text-truncate" style="max-width: 100%;">{{ chat.question }}</strong>
                                    <small class="text-muted">{{ chat.timestamp }}</small>
                                </div>
                                {% endfor %}
                            {% else %}
                                <div class="p-3 text-center text-muted">
                                    No previous questions
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6 d-flex flex-column">
                <div class="chat-container flex-grow-1 mb-2" id="chat-container">
                    <div class="assistant-message">
                        <p>Hello! I'm CiteSeekerAI, your research assistant. Ask me a research question, and I'll analyze academic literature to provide you with a comprehensive answer.</p>
                        <p>For example: "What is the difference between water scarcity and water security?"</p>
                    </div>
                </div>

                <form id="question-form" class="mb-2 flex-shrink-0">
                    <div class="input-group">
                        <input type="text" id="question-input" class="form-control" placeholder="Type your research question..." required>
                        <select id="subquestions-count" class="form-select" style="max-width: 180px;">
                            <option value="1">1 Subquestion</option>
                            <option value="2">2 Subquestions</option>
                            <option value="3" selected>3 Subquestions</option>
                            <option value="4">4 Subquestions</option>
                            <option value="5">5 Subquestions</option>
                            <option value="6">6 Subquestions</option>
                            <option value="7">7 Subquestions</option>
                            <option value="8">8 Subquestions</option>
                            <option value="9">9 Subquestions</option>
                            <option value="10">10 Subquestions</option>
                        </select>
                        <button class="btn btn-primary" type="submit" id="submit-btn">Ask</button>
                    </div>
                </form>

                <div class="row g-2 mb-2 flex-shrink-0" id="slider-controls-container">
                    <div class="col-md-6">
                        <label for="top-k-abstracts-slider" class="form-label">
                            Papers to Search
                            <span class="info-tooltip">
                                <i class="bi bi-info-circle"></i>
                                <span class="tooltip-text">Controls how many papers are initially retrieved and analyzed. Higher values mean a broader literature search but may take longer and less specific results. Lower values allow you to zoom in on a select number of relevant papers.</span>
                            </span>
                        </label>
                        <div class="d-flex align-items-center">
                            <input type="range" class="form-range me-2" id="top-k-abstracts-slider" min="5" max="100" value="20">
                            <span id="top-k-abstracts-value" class="slider-value">20</span>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <label for="top-k-chunks-slider" class="form-label">
                            Chunks for Answer
                            <span class="info-tooltip">
                                <i class="bi bi-info-circle"></i>
                                <span class="tooltip-text">Controls how many text chunks from collected papers are used to generate the final answer. Higher values provide more context but increase costs. Lower values only results in those pieces of text most relevant to the question</span>
                            </span>
                        </label>
                        <div class="d-flex align-items-center">
                            <input type="range" class="form-range me-2" id="top-k-chunks-slider" min="3" max="60" value="30">
                            <span id="top-k-chunks-value" class="slider-value">30</span>
                        </div>
                    </div>
                </div>
                
                <div id="status-container" class="alert alert-info d-none flex-shrink-0 mb-1">
                    <span id="status-text">Processing your question...</span>
                    <div class="progress mt-2">
                        <div id="progress-bar" class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 0%"></div>
                    </div>
                </div>
            </div>

            <div class="col-md-3 d-flex flex-column">
                <div id="outline-container" class="card flex-grow-1 d-flex flex-column">
                    <div class="card-header">
                        Outline
                    </div>
                    <div class="card-body p-0 flex-grow-1 d-flex flex-column">
                        <div class="flex-grow-1 overflow-auto p-3">
                            <div class="text-center text-muted">No outline to display.</div>
                        </div>
                    </div>
                </div>
                <div id="references-container" class="card flex-grow-1 d-flex flex-column">
                    <div class="card-header">
                        References
                    </div>
                    <div class="card-body p-0 flex-grow-1 d-flex flex-column">
                        <div id="references-list" class="flex-grow-1 overflow-auto p-3">
                            <div class="text-center text-muted">No references to display.</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="/static/js/chat.js"></script>
</body>
</html>
